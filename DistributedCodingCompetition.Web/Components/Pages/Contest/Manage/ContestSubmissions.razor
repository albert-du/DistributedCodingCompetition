@*
        public ICollection<User> Submissions { get; set; } = [];

        view, and delete contest submissions
*@

@page "/contest/{id:guid}/manage/submissions"
@inject IApiService ApiService
@inject IModalService ModalService
@inject IUserStateService UserStateService
@rendermode InteractiveServer
<AuthCheck Contest=Id Admin />

<PageTitle>@contest?.Name Submissions</PageTitle>


@code {
    [Parameter]
    public Guid Id { get; set; }

    [SupplyParameterFromQuery]
    public int Page { get; set; } = 1;
    [SupplyParameterFromQuery]
    public int PageSize { get; set; } = 10;

    List<Submission> Submissions = [];
    Contest? contest;

    protected override async Task OnInitializedAsync()
    {
        await LoadAsync();
        // make sure the user is a contest admin
        var user = await UserStateService.UserAsync();
        var userId = user?.Id;

        (var success, var c) = await ApiService.TryReadContestAsync(Id);
        if (!success)
        {
            ModalService.ShowError("Failed to load contest", "Internal error");
            return;
        }
        contest = c;
    }

    private async Task LoadAsync()
    {
        var sub = ApiService.TryReadContestSubmissionsAsync(Id, Page, PageSize);
        var cont = ApiService.TryReadContestAsync(Id);
        (var success, var submissions) = await sub;
        if (!success)
        {
            ModalService.ShowError("Failed to load submissions", "Internal error");
            return;
        }
        (success, contest) = await cont;

        if (!success)
        {
            ModalService.ShowError("Failed to load contest", "Internal error");
            return;
        }

        if (contest is null)
        {
            ModalService.ShowError("Contest not found", "");
            return;
        }

        Submissions = [.. submissions];

    }
}